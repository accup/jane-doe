# ADR-0001: 記憶の検索と更新の仕組み

## ステータス

承認済み

## コンテキスト

Jane Doe プロジェクトは、AIとの対話における長期記憶と文脈の継続性を実現するシステムである。AIは時間的・空間的な隔たりのある情報を記憶によって結びつけることが難しいという課題があり、これを解決するために記憶の検索と更新の仕組みを定義する必要がある。

人間の記憶と対話のプロセスを模倣し、以下の特性を実現したい：

1. 対話を受け取った瞬間の脳の状態（何に注目しているか）
2. 読んだ情報は必ず一度脳を通る（すべての情報を処理）
3. 対話中に必要に応じて情報を探す行為
4. 反復学習による記憶の強化

## 決定

### 記憶の検索

以下の2つのトリガーを採用する：

#### A. 自動検索（必須）

- すべてのユーザー発言に対して自動的に記憶を検索する
- 「今何に注目しているか」を基に、記憶の構造から機械的に関連情報を取得
- AI による分析を介さず、対話を受け取った瞬間の脳の状態を模倣

#### B. Claude判断検索（オプション）

- MCP ツールとして検索機能を提供
- Claude が対話中に必要と判断した場合、追加で記憶を検索可能
- 人間が対話中に情報を探す行為を模倣

#### 不採用: ユーザー明示的検索

- `/remember` のようなコマンドによる明示的検索は採用しない
- 理由: ユーザーに手間を取らせるため

### 記憶の更新

以下の2つのタイミングで更新を行う：

#### A. 自動更新（必須）

- すべての対話情報を一度更新処理に通す
- 人間の「読んだことは脳を通る」プロセスを模倣
- 記憶の構造に沿って情報を整理・保存
- 情報の重要性は記憶の構造によって管理（更新処理で取捨選択しない）

#### B. 反復学習（オプション）

- MCP 呼び出しにより、重要な情報を意図的に強化
- 人間の反復学習を模倣

### MCP の役割

#### 現在（Phase 1）

- 単純な RDB の読み書き機能を提供
- 記憶の構造が未定義の段階では、シンプルな実装に留める

#### 将来

- MCP サーバー内部で Claude をサブエージェントとして呼び出す
- 情報を適切な構造に整理して記憶する役割を担う

## 結果

### 利点

1. **自然な対話フロー**: ユーザーが意識せずとも文脈が維持される
2. **人間の認知プロセスに近い**: 記憶の検索・更新が人間の思考パターンを模倣
3. **段階的な拡張性**: Phase 1 はシンプル、将来的に高度化可能
4. **柔軟性**: 自動処理と明示的処理の両方をサポート

### トレードオフ

1. **処理コスト**: すべての発言で検索・更新が発生するため、API 呼び出しコストが増加
2. **初期の記憶構造依存**: 「今何に注目しているか」を表現する記憶構造の設計が重要
3. **複雑性**: 将来的に MCP 内でサブエージェントを動かす構成は実装が複雑

### 対話フロー

```
1. ユーザーが Slack で発言
2. Slack App がメッセージを受信
3. [自動検索] 「注目している情報」を基に記憶を取得
4. Claude API に (発言 + 取得した記憶) を渡す
5. Claude が応答を生成
   - 必要に応じて MCP ツールで追加検索（B判断検索）
   - 必要に応じて MCP ツールで反復学習（B更新）
6. [自動更新] すべての情報を記憶の構造に沿って保存
7. Slack に応答を返す
```

## 関連 ADR

なし（初回の ADR）
